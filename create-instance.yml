---
- name: Create Manager instance
  hosts: localhost
  roles:
    - gce-instance
  gather_facts: false
  connection: local
  roles:
    - gce-instance
  vars:
    gcp_project: round-plating-286915
    gcp_cred_kind: serviceaccount
    gcp_cred_file: /Users/michaelschmidt/git/kiratech-techchallenge/round-plating-286915-49944854916b.json
    zone: "us-central1-b"
    region: "us-central1"
    image: "projects/ubuntu-os-cloud/global/images/family/ubuntu-1804-lts"
    vm_name: manager


- name: set up Swarm Manager
  hosts: swarm_instances
  roles:
    - docker
  become: true
  connection: ssh
  tasks:
    - name: Init a new swarm with default parameters
      docker_swarm:
        state: present
        advertise_addr: "{{ hostvars['localhost']['host_ip'] }}"
      register: swarm
    - set_fact:
        register_key: "{{ swarm.swarm_facts.JoinTokens.Worker }}"
    - debug:       
        msg: "{{ register_key }}"

